language:
    - cpp
compiler:
    - clang
    - gcc
dist:
    - trusty
group: edge
cache:
    directories:
    - cache/openblas-build/lib
    - obj
before_install:
    - cd $TRAVIS_BUILD_DIR
    - sudo apt-get update -qq -y || true
    - sudo apt-get install -y gfortran
    - sudo apt-get install -y lcov
    - mkdir -p cache
    - |
      if [ ! -e cache/openblas-build/lib/libopenblas.so.0 ]; then
        git clone -q --branch v0.2.20 --depth 1 https://github.com/xianyi/OpenBLAS cache/openblas
        cd cache/openblas
        make && make PREFIX=$TRAVIS_BUILD_DIR/cache/openblas-build install
      fi
script:
    - cd $TRAVIS_BUILD_DIR
    - make test CXXFLAGS="-Wall -I$TRAVIS_BUILD_DIR/cache/openblas-build/include" LDFLAGS="-L$TRAVIS_BUILD_DIR/cache/openblas-build/lib -Wl,-rpath,$TRAVIS_BUILD_DIR/cache/openblas-build/lib"
after_success:
    - cd $TRAVIS_BUILD_DIR
    - lcov -c -b . -d obj --no-external -o obj/lcov.info
    - bash <(curl -s https://codecov.io/bash) -X gcov -f obj/lcov.info
